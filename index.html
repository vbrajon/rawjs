<meta charset="utf-8" />
<link rel="icon" href="data:,">
<style>
  /* Prism - Raw theme */
  pre { overflow: auto;margin: .5em 0;padding: 1em; }
  pre, code[class*="language-"] { color: #ccc;background: #111;border-radius: .3em;font: 400 1em/1.5 Menlo, monospace;white-space: pre;tab-size: 2;hyphens: none; }
  :not(pre) > code[class*="language-"] { padding: .1em; }
  .token.comment { color: #555; }
  .token.class-name { color: #fd0; }
  .token.keyword { color: #f6e; }
  .token.property-access { color: #f34; }
  .token.boolean, .token.number { color: #fa3; }
  .token.string, .token.regex { color: #7d0; }
  .token.function, .token.method { color: #39f; }
  .token.operator { color: #3df; }
  [id] { cursor: pointer; }
  [id]:hover { background: linear-gradient(to right,#03f,#0bf);-webkit-background-clip: text;-webkit-text-fill-color: transparent; }
</style>
<style>
  * { outline: inherit;font: inherit;-moz-osx-font-smoothing: grayscale;-webkit-font-smoothing: antialiased;-webkit-tap-highlight-color: transparent;-webkit-text-size-adjust: 100%;box-sizing: border-box;caret-color: var(--primary); }
  body { margin: 80px;color: white;background: #2f3138;font-family: sans-serif;font-size: 18px; }
  h1 { display: flex;align-items: center;justify-content: space-between;color: #afafaf;font-size: 22px;font-weight: 300;text-transform: uppercase;letter-spacing: 0.1em; }
  button { opacity: 0.8;padding: 5px 10px;color: #fa3;background: none;border: 1px solid #fa3;border-radius: 4px;font-size: 18px;text-transform: uppercase; }
  button:hover { opacity: 1; }
  pre { margin: 0;padding: 0;background: none; }
  pre.error,
  pre.warning { padding: 10px;white-space: normal; }
  pre.error { color: #f34; }
  .testarea { margin-top: 15px;transition: 0.4s; }
  .testarea.success { background: #2f4138!important; }
  .testarea.warning { background: #4f4138!important; }
  .testarea.error { background: #4f3138!important; }
  .testarea svg { position: absolute;top: calc(50% - 17px);right: 0;cursor: pointer;margin: 5px 10px;border: none;fill: #fa3; }
  .testarea .time { position: absolute;top: calc(50% - 17px);right: 40px;line-height: 34px; }
  [v-cloak] { display: none; }

  .testarea { position: relative;overflow: hidden;width: 100%;color: white;background-color: #2a2b2f;border-radius: 10px;font-family: source-code-pro, Menlo, Monaco, Consolas, "Courier New";line-height: 27px; }
  .testarea textarea { position: absolute;top: 0px;left: 0px;overflow: hidden;width: 100%;height: 100%;padding: 20px;color: inherit;background: none;border: none;outline: none;white-space: pre-wrap;-webkit-font-smoothing: antialiased;-webkit-text-fill-color: transparent;resize: none; }
  .testarea pre { position: relative;pointer-events: none;margin: 0px;padding: 20px;background: none;border: 0px;white-space: pre-wrap; }
</style>
<main v-cloak>
  <h1>Setup Code</h1>
  <testarea v-model="setup"></testarea>
  <h1>Test Cases<button @click="tests = [['', null]].concat(tests)">Add Case</button></h1>
  <testarea :value="test[0]" :expect="test[1]" :setup="setup" @input="Vue.set(tests[i], 0, $event)" @expect="Vue.set(tests[i], 1, $event)" @clear="tests = tests.filter((d, di) => di !== i)" v-for="test, i in tests"></testarea>
</main>
<script src="https://unpkg.com/vue@2.6.10/dist/vue.min.js"></script>
<script src="https://unpkg.com/prismjs@1.16.0/prism.js"></script>
<script src="https://unpkg.com/prismjs@1.16.0/components/prism-markdown.js"></script>
<script src="https://unpkg.com/prismjs@1.16.0/components/prism-js-extras.js"></script>
<script>
  Vue.component('testarea', {
    props: ['value', 'expect', 'setup'],
    template: `<div class="test">
      <div style="display: flex;">
        <div class="testarea">
          <textarea :value="value" @input="$emit('input', $event.target.value)"></textarea>
          <pre v-html="Prism.highlight(value || '', Prism.languages.js, 'js')"></pre>
        </div>
        <div v-if="$listeners.expect" class="testarea" :class="output">
          <textarea :value="JSON.stringify(expect || null, true, 2).replace(/\\s+/g, ' ')" @input="tryparse"></textarea>
          <pre v-html="Prism.highlight(JSON.stringify(expect || null, true, 2).replace(/\\s+/g, ' '), Prism.languages.js, 'js')"></pre>
          <svg @click="$emit('clear')" v-if="$listeners.clear" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg>
          <div class="time" v-if="output.time">{{ output.time < 1 ? ~~(output.time * 1000) + 'μs' : output.time < 1000 ? ~~output.time + 'ms' : ~~(output.time / 1000) + 's' }}</div>
        </div>
      </div>
      <div style="display: flex;">
        <pre class="error" v-if="output.error">{{ output.error }}</pre>
        <pre class="warning" v-if="output.warning" v-html="output.warning"></pre>
      </div>
    </div>`,
    data() {
      return {
        output: {},
      }
    },
    methods: {
      tryparse($event) {
        const v = $event.target.value
        $event.target.parentElement.querySelector('pre').innerHTML = Prism.highlight(v, Prism.languages.js, 'js')
        try {
          return this.$emit('expect', JSON.parse(v))
        } catch(e) {
          $event.target.parentElement.className = 'testarea'
        }
      },
    },
    created() {
      let run = 0
      this.$watch(() => [this.setup, this.value, this.expect], async () => {
        const r = ++run
        let output, error
        this.output = {}
        try {
          output = await eval(`async () => {
            ${this.setup}
            const start = performance.now()
            let result;${this.value.split('\n').filter(x => x).map((l, i, ls) => i === ls.length - 1 && !/^const/.test(l) ? 'result = ' + l : l).join('\n')};
            const time = performance.now() - start
            return { result, time }
          }`)()
        } catch(e) {
          error = e
        } finally {
          if (r !== run) return
          let success, warning
          try {
            const eq = (a, b) => {
              if (a === b) return true
              if (a instanceof Date && b instanceof Date) return a.getTime() === b.getTime()
              if (!a || !b || (typeof a != 'object' && typeof b !== 'object')) return a === b
              if (a === null || a === undefined || b === null || b === undefined) return false
              if (a.prototype !== b.prototype) return false
              const keys = Object.keys(a)
              if (keys.length !== Object.keys(b).length) return false
              return keys.every(k => eq(a[k], b[k]))
            }
            success = eq(output.result, this.expect)
            warning = !success && `Expected ${Prism.highlight(Object.prototype.toString.call(output.result).slice(8, -1), Prism.languages.js, 'js')}(${Prism.highlight(JSON.stringify(output.result, null, 2), Prism.languages.js, 'js')})<br>to equal ${Prism.highlight(Object.prototype.toString.call(this.expect).slice(8, -1), Prism.languages.js, 'js')}(${Prism.highlight(JSON.stringify(this.expect, null, 2), Prism.languages.js, 'js')})`
          } catch(e) {}
          this.output = {
            ...output,
            error,
            warning: !error && warning,
            success: !error && success,
          }
        }
      }, { immediate: true })
    },
  })
  new Vue({
    el: 'main',
    data() {
      return {
        setup: `await import('./raw.js')
raw()
const arr = [{ name: 'Jane Doe', age: 22 }, { name: 'John Doe', age: 29, birthdate: new Date('1989-11-14') }, { name: 'Janette Doe', age: 22 }, { name: 'Johnny Doe', age: 71, birthdate: new Date('Feb 26, 1932') }]
const obj = arr[0]
const str = 'i am: The1\\nAND\\t,_L?on*e%ly.'
const date = new Date('2019-01-20 10:09:08')`,
        tests: [
          // Object
          ['obj.map(v => v * 2 || v)', { name: 'Jane Doe', age: 44 }],
          ['obj.find(22)', 'age'],
          [`obj.filter(Number)`, { age: 22 }],
          ['obj.reduce((acc, v, k) => (acc[v] = k, acc), {})', { 'Jane Doe': 'name', 22: 'age' }],
          // Array
          [`arr.map('name').sort()`, ['Jane Doe', 'Janette Doe', 'John Doe', 'Johnny Doe']],
          [`arr.map('age').unique()`, [22, 29, 71]],
          [`arr.map('age').sum()`, 144],
          [`arr.map('age').min()`, 22],
          [`arr.map('age').max()`, 71],
          [`arr.map('age').mean()`, 36],
          [`arr.map('age').median()`, 25.5],
          [`arr.group('age').map(g => g.map('name'))`, { 22: ['Jane Doe', 'Janette Doe'], 29: ['John Doe'], 71: ['Johnny Doe'] }],
          [`arr.group(['age', 'name']).map(g => g.map(g => g.map('birthdate')))`, { 22: { 'Jane Doe': [], 'Janette Doe': [] }, 29: { 'John Doe': [] }, 71: { 'Johnny Doe': [] } }],
          [`arr.sort(['-age', 'name']).map(d => [d.age, d.name])`, [[71, 'Johnny Doe'], [29, 'John Doe'], [22, 'Jane Doe'], [22, 'Janette Doe']]],
          [`[null, 'a', undefined].filter()`, ['a']],
          [`[{ a: { b: 'one' } }, { a: { b: 'two' } }].map('a.b.capitalize')`, ['One', 'Two']],
          // Function
          [`((a, b) => [a, b]).partial(null, 2)(1)`, [1, 2]],
          [`const mem = (x => x / 2).memoize()
mem(2)
mem.cache['[2]']`, 1],
          [`await (() => 1).wait(500).promise`, 1],
          [`let n = 0
const inc = (() => n++).every(100, 5)
await (() => n).wait(1000).promise`, 5],
          [`let n = 0
const inc = (() => n++).debounce(100)
inc.every(50, 8)
inc.wait(800)
await (() => n).wait(1000).promise`, 2],
          [`let n = 0
const inc = (() => n++).throttle(100)
inc.every(50, 8)
inc.wait(800)
await (() => n).wait(1000).promise`, 4],
          // String
          [`str.words()`, ['i', 'am', 'The', '1', 'AND', 'Lonely']],
          [`str.join('title')`, 'I Am The 1 And Lonely'],
          [`str.join('-')`, 'i-am-The-1-AND-Lonely'],
          [`str.join('dash')`, 'i-am-the-1-and-lonely'],
          [`str.join('underscore')`, 'i_am_the_1_and_lonely'],
          [`str.join('camel')`, 'iAmThe1AndLonely'],
          [`str.join('pascal')`, 'IAmThe1AndLonely'],
          [`'{}{}{}'.format('a', 'b')`, 'ab{}'],
          [`'{1}{0}{}{1}'.format('a', 'b')`, 'baab'],
          [`'{k2}{k2}{k3}'.format({ k1: 'a', k2: x => 'b' })`, 'bb{k3}'],
          [`'66 pears x 3 apples'.format({ [/\\d+/]: x => x * 2 })`, '132 pears x 6 apples'],
          // Number
          [`(.1 * 3).format()`, .3],
          [`(-.000123456789).format(1)`, '-100µ'],
          [`(123456789000).format(2)`, '120G'],
          [`(1010.01010).format('en')`, '1,010.01'],
          [`(1010.01010).format('fr')`, '1 010,01'],
          [`(3.1415).floor()`, 3],
          [`Math.PI.cos()`, -1],
          [`(3).pow(2)`, 9],
          [`(36666666).duration()`, '10 hours'],
          // Date
          [`date.format()`, '2019-01-20'],
          [`date.format('DD/MM/YYYY hhhmmm')`, '20/01/2019 10h09m'],
          [`date.format('day, month, year', 'fr')`, '20 janvier 2019'],
          [`date.format('month, day, weekday, hour, minute, second')`, 'Sunday, January 20, 10:09:08 AM'],
          [`date.plus('day').format()`, '2019-01-21'],
          [`new Date('2019-05-31').minus('3 month').format()`, '2019-02-28'],
          [`new Date('2019-01-31').plus('1 month').format()`, '2019-02-28'],
          [`new Date('2016-02-29').plus('1 year').format()`, '2017-02-28'],
          [`date.plus('1 month, 11 days').format()`, '2019-02-28'],
          [`date.minus('1 month, 2 days').format()`, '2018-12-18'],
          [`date.start('month').toISOString()`, '2018-12-31T23:00:00.000Z'],
          [`date.end('year').toISOString()`, '2019-12-31T22:59:59.000Z'],
          [`new Date().plus('14 days').relative()`, '2 weeks from now'],
          // RegExp
          [`/(parenthesis)/.escape().source`, '\\(parenthesis\\)'],
          [`/insensitive/.plus('i').flags`, 'i'],
          [`/sensitive/i.minus('i').flags`, ''],
          // Advanced - Extend
          [`(Object.custom = x => 1, raw(), typeof {}.custom)`, 'function'],
          [`(delete Object.prototype.custom, delete Object.custom, typeof {}.custom)`, 'undefined'],
          ['raw.version', '1.1.1'],
        ],
      }
    },
  })
</script>
