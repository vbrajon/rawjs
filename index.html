<meta charset="utf-8" />
<link rel="icon" href="data:,">
<style>
  /* Prism - Raw theme */
  pre { overflow: auto;margin: .5em 0;padding: 1em; }
  pre, code[class*="language-"] { color: #ccc;background: #111;border-radius: .3em;font: 400 1em/1.5 Menlo, monospace;white-space: pre;tab-size: 2;hyphens: none; }
  :not(pre) > code[class*="language-"] { padding: .1em; }
  .token.comment { color: #555; }
  .token.class-name { color: #fd0; }
  .token.keyword { color: #f6e; }
  .token.property-access { color: #f34; }
  .token.boolean, .token.number { color: #fa3; }
  .token.string, .token.regex { color: #7d0; }
  .token.function, .token.method { color: #39f; }
  .token.operator { color: #3df; }
  [id] { cursor: pointer; }
  [id]:hover { background: linear-gradient(to right,#03f,#0bf);-webkit-background-clip: text;-webkit-text-fill-color: transparent; }
</style>
<style>
  * { font: inherit;outline: inherit;box-sizing: border-box;caret-color: var(--primary);-webkit-tap-highlight-color: transparent;-webkit-text-size-adjust: 100%;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale; }
  body { margin: 80px;color: white;background: #2f3138;font-size: 18px;font-family: sans-serif; }
  h1 { display: flex;align-items: center;justify-content: space-between;color: #afafaf;font-size: 22px;font-weight: 300;text-transform: uppercase;letter-spacing: 0.1em; }
  button { opacity: .8;padding: 5px 10px;color: #fa3;background: none;border: 1px solid #fa3;border-radius: 4px;font-size: 18px;text-transform: uppercase; }
  button:hover { opacity: 1; }
  pre { margin: 0;padding: 0;background: none; }
  pre.error, pre.warning { padding: 10px;white-space: normal; }
  pre.error { color: #f34; }
  .testarea { margin-top: 15px;transition: .4s; }
  .testarea.success { background: #2f4138!important; }
  .testarea.warning { background: #4f4138!important; }
  .testarea.error { background: #4f3138!important; }
  .testarea svg { cursor: pointer;position: absolute;top: calc(50% - 17px);right: 0;margin: 5px 10px;border: none;fill: #fa3; }
  .testarea .time { position: absolute;top: calc(50% - 17px);right: 40px;line-height: 34px; }
  [v-cloak] { display: none; }
</style>
<main v-cloak>
  <h1>Setup Code</h1>
  <testarea v-model="setup"></testarea>
  <h1>Test Cases<button @click="tests = [['', null]].concat(tests)">Add Case</button></h1>
  <testarea :value="test[0]" :expect="test[1]" :setup="setup" @input="Vue.set(tests[i], 0, $event)" @expect="Vue.set(tests[i], 1, $event)" @clear="tests = tests.filter((d, di) => di !== i)" v-for="test, i in tests"></testarea>
</main>
<script src="https://unpkg.com/vue@2.6.10/dist/vue.min.js"></script>
<script src="https://unpkg.com/prismjs@1.16.0/prism.js"></script>
<script src="https://unpkg.com/prismjs@1.16.0/components/prism-markdown.js"></script>
<script src="https://unpkg.com/prismjs@1.16.0/components/prism-js-extras.js"></script>
<script>
  // import 'https://cdn.jsdelivr.net/gh/vbrajon/rawjs/raw.js'
  Vue.component('testarea', {
    props: ['value', 'expect', 'setup'],
    template: `<div class="test">
      <div style="display: flex;">
        <div class="testarea" style="position: relative;text-align: left;box-sizing: border-box;padding: 0px;overflow: hidden;width: 100%;font-size: 18px;background-color: rgb(42, 43, 47);color: rgb(255, 255, 255);border-radius: 10px;font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;;line-height: 27px;">
          <textarea :value="value" @input="$emit('input', $event.target.value)" style="margin: 0px;border: 0px;background: none;box-sizing: inherit;display: inherit;font-family: inherit;font-size: inherit;font-style: inherit;font-variant-ligatures: inherit;font-weight: inherit;letter-spacing: inherit;line-height: inherit;tab-size: inherit;text-indent: inherit;text-rendering: inherit;text-transform: inherit;white-space: pre-wrap;word-break: keep-all;overflow-wrap: break-word;position: absolute;top: 0px;left: 0px;height: 100%;width: 100%;resize: none;color: inherit;overflow: hidden;outline: none;-webkit-font-smoothing: antialiased;-webkit-text-fill-color: transparent;padding: 20px;"></textarea>
          <pre v-html="Prism.highlight(value || '', Prism.languages.js, 'js')" style="margin: 0px;border: 0px;background: none;box-sizing: inherit;display: inherit;font-family: inherit;font-size: inherit;font-style: inherit;font-variant-ligatures: inherit;font-weight: inherit;letter-spacing: inherit;line-height: inherit;tab-size: inherit;text-indent: inherit;text-rendering: inherit;text-transform: inherit;white-space: pre-wrap;word-break: keep-all;overflow-wrap: break-word;position: relative;pointer-events: none;padding: 20px;"></pre>
        </div>
        <div v-if="$listeners.expect" class="testarea" :class="output" style="position: relative;text-align: left;box-sizing: border-box;padding: 0px;overflow: hidden;width: 100%;font-size: 18px;background-color: rgb(42, 43, 47);color: rgb(255, 255, 255);border-radius: 10px;font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;;line-height: 27px;">
          <textarea :value="JSON.stringify(expect || null, true, 2).replace(/\\s+/g, ' ')" @input="$emit('expect', JSON.parse($event.target.value))" style="margin: 0px;border: 0px;background: none;box-sizing: inherit;display: inherit;font-family: inherit;font-size: inherit;font-style: inherit;font-variant-ligatures: inherit;font-weight: inherit;letter-spacing: inherit;line-height: inherit;tab-size: inherit;text-indent: inherit;text-rendering: inherit;text-transform: inherit;white-space: pre-wrap;word-break: keep-all;overflow-wrap: break-word;position: absolute;top: 0px;left: 0px;height: 100%;width: 100%;resize: none;color: inherit;overflow: hidden;outline: none;-webkit-font-smoothing: antialiased;-webkit-text-fill-color: transparent;padding: 20px;"></textarea>
          <pre v-html="Prism.highlight(JSON.stringify(expect || null, true, 2).replace(/\\s+/g, ' '), Prism.languages.js, 'js')" style="margin: 0px;border: 0px;background: none;box-sizing: inherit;display: inherit;font-family: inherit;font-size: inherit;font-style: inherit;font-variant-ligatures: inherit;font-weight: inherit;letter-spacing: inherit;line-height: inherit;tab-size: inherit;text-indent: inherit;text-rendering: inherit;text-transform: inherit;white-space: pre-wrap;word-break: keep-all;overflow-wrap: break-word;position: relative;pointer-events: none;padding: 20px;"></pre>
          <svg @click="$emit('clear')" v-if="$listeners.clear" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg>
          <div class="time" v-if="output.time">{{ output.time < 1 ? ~~(output.time * 1000) + 'μs' : output.time < 1000 ? ~~output.time + 'ms' : ~~(output.time / 1000) + 's' }}</div>
        </div>
      </div>
      <div style="display: flex;">
        <pre class="error" v-if="output.error">{{ output.error }}</pre>
        <pre class="warning" v-if="output.warning" v-html="output.warning"></pre>
      </div>
    </div>`,
    data() {
      return {
        output: {},
      }
    },
    created() {
      let run = 0
      this.$watch(() => [this.setup, this.value, this.expect], async () => {
        const r = ++run
        let output, error
        this.output = {}
        try {
          output = await eval(`async () => {
            ${this.setup}
            const start = performance.now()
            const result = ${this.value || 'null'}
            const time = performance.now() - start
            return { result, time }
          }`)()
        } catch(e) {
          error = e
        } finally {
          if (r !== run) return
          let success, warning
          try {
            const eq = (a, b) => {
              if (a === b) return true
              if (a instanceof Date && b instanceof Date) return a.getTime() === b.getTime()
              if (!a || !b || (typeof a != 'object' && typeof b !== 'object')) return a === b
              if (a === null || a === undefined || b === null || b === undefined) return false
              if (a.prototype !== b.prototype) return false
              const keys = Object.keys(a)
              if (keys.length !== Object.keys(b).length) return false
              return keys.every(k => eq(a[k], b[k]))
            }
            success = eq(output.result, this.expect)
            warning = !success && `Expected ${Prism.highlight(Object.prototype.toString.call(output.result).slice(8, -1), Prism.languages.js, 'js')}(${Prism.highlight(JSON.stringify(output.result, null, 2), Prism.languages.js, 'js')})<br>to equal ${Prism.highlight(Object.prototype.toString.call(this.expect).slice(8, -1), Prism.languages.js, 'js')}(${Prism.highlight(JSON.stringify(this.expect, null, 2), Prism.languages.js, 'js')})`
          } catch(e) {}
          this.output = {
            ...output,
            error,
            warning: !error && warning,
            success: !error && success,
          }
        }
      }, { immediate: true })
    },
  })
  new Vue({
    el: 'main',
    data() {
      return {
        setup: `await import('http://127.0.0.1:8000/raw.js')
raw()
const arr = [{ name: 'Jane Doe', age: 22 }, { name: 'John Doe', age: 29, birthdate: new Date('1989-11-14') }, { name: 'Janette Doe', age: 22 }, { name: 'Johnny Doe', age: 71, birthdate: new Date('Feb 26, 1932') }]
const obj = arr[0]
const str = 'i am: The1\\nAND\\t,_L?on*e%ly.'
const date = new Date('2019-01-20 10:09:08')`,
        tests: [
          // Object
          ['obj.map(v => v * 2 || v)', { name: 'Jane Doe', age: 44 }],
          ['obj.find(22)', 'age'],
          [`obj.filter(Number)`, { age: 22 }],
          ['obj.reduce((acc, v, k) => (acc[v] = k, acc), {})', { 'Jane Doe': 'name', 22: 'age' }],
          // Array
          [`arr.map('name').sort()`, ['Jane Doe', 'Janette Doe', 'John Doe', 'Johnny Doe']],
          [`arr.map('age').unique()`, [22, 29, 71]],
          [`arr.map('age').sum()`, 144],
          [`arr.map('age').min()`, 22],
          [`arr.map('age').max()`, 71],
          [`arr.map('age').mean()`, 36],
          [`arr.map('age').median()`, 25.5],
          [`arr.group('age').map(g => g.map('name'))`, { 22: ['Jane Doe', 'Janette Doe'], 29: ['John Doe'], 71: ['Johnny Doe'] }],
          [`arr.group(['age', 'name']).map(g => g.map(g => g.map('birthdate')))`, { 22: { 'Jane Doe': [], 'Janette Doe': [] }, 29: { 'John Doe': [] }, 71: { 'Johnny Doe': [] } }],
          [`arr.sort(['-age', 'name']).map(d => [d.age, d.name])`, [[22, 'Janette Doe'], [22, 'Jane Doe'], [29, 'John Doe'], [71, 'Johnny Doe']]],
          [`[null, 'a', undefined].filter()`, ['a']],
          [`[{ a: { b: 'one' } }, { a: { b: 'two' } }]\n.map('a.b.capitalize')`, ['One', 'Two']],
          // String
          [`str.words()`, ['i', 'am', 'The', '1', 'AND', 'Lonely']],
          [`str.join('title')`, 'I Am The 1 And Lonely'],
          [`str.join('-')`, 'i-am-The-1-AND-Lonely'],
          [`str.join('dash')`, 'i-am-the-1-and-lonely'],
          [`str.join('underscore')`, 'i_am_the_1_and_lonely'],
          [`str.join('camel')`, 'iAmThe1AndLonely'],
          [`str.join('pascal')`, 'IAmThe1AndLonely'],
          [`'{}{}{}'.format('a', 'b')`, 'ab{}'],
          [`'{1}{0}{}{1}'.format('a', 'b')`, 'baab'],
          [`'{k2}{k2}{k3}'.format({ k1: 'a', k2: x => 'b' })`, 'bb{k3}'],
          [`'66 pears x 3 apples'.format({ [/\d+/]: x => x * 2 })`, '132 pears x 6 apples'],
          // Number
          [`(1010.0101).format()`, '1,010.01'],
          [`(1010.0101).format(1)`, '1k'],
          [`(1010.0101).format('fr')`, '1 010,01'],
          [`(3.1415).floor()`, 3],
          [`Math.PI.cos()`, -1],
          [`(3).pow(2)`, 9],
          [`(102 / 100 - 1).fix()`, .02],
          [`(3666000).duration()`, '1 hour'],
          // Date
          [`date.format()`, '2019-01-20'],
          [`date.format('DD/MM/YYYY hhhmmm')`, '20/01/2019 10h09m'],
          [`date.format('day, month, year', 'fr')`, '20 janvier 2019'],
          [`date.format('month, day, weekday, hour, minute, second')`, 'Sunday, January 20, 10:09:08 AM'],
          [`date.plus('day').format()`, '2019-01-21'],
          [`date.minus('1 month, 2 days').format()`, '2018-12-18'],
          [`date.start('month').toISOString()`, '2018-12-31T23:00:00.000Z'],
          [`date.end('month').toISOString()`, '2019-01-31T22:59:59.000Z'],
          [`new Date().plus('14 days').relative()`, '2 weeks from now'],
          // RegExp
          [`/(parenthesis)/.escape().source`, '\\(parenthesis\\)'],
          [`/insensitive/.plus('i').flags`, 'i'],
          [`/sensitive/i.minus('i').flags`, ''],
          // Advanced - Extend
          [`(Object.custom = x => 1, raw(), typeof {}.custom)`, 'function'],
          [`(delete Object.prototype.custom, delete Object.custom, typeof {}.custom)`, 'undefined'],
          ['raw.version', '1.1.1'],
        ],
      }
    },
  })
</script>
